/*
Deployment script for HouseApp

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "HouseApp"
:setvar DefaultFilePrefix "HouseApp"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL15.MSSQLSERVER19\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL15.MSSQLSERVER19\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Creating Table [TRX].[TransactionAmount]...';


GO
CREATE TABLE [TRX].[TransactionAmount] (
    [TransactionAmountId] INT             IDENTITY (1, 1) NOT NULL,
    [BillMonth]           NVARCHAR (50)   NOT NULL,
    [BillYear]            INT             NOT NULL,
    [TenantRoomDetailsId] INT             NOT NULL,
    [PowerAmount]         DECIMAL (10, 2) NOT NULL,
    [WaterAmount]         DECIMAL (10, 2) NOT NULL,
    [OtherAmount]         DECIMAL (10, 2) NOT NULL,
    [IsOwnerControl]      BIT             NOT NULL,
    [IsActive]            BIT             NOT NULL,
    [UpdatedDate]         DATETIME        NULL,
    [UpdatedBy]           NVARCHAR (100)  NULL,
    CONSTRAINT [PK_Transaction_Amount_Id] PRIMARY KEY CLUSTERED ([TransactionAmountId] ASC)
);


GO
PRINT N'Creating Table [TRX].[TransactionBills]...';


GO
CREATE TABLE [TRX].[TransactionBills] (
    [TransactionBillId]   UNIQUEIDENTIFIER NOT NULL,
    [TransactionAmountId] INT              NOT NULL,
    [IsAmountPaid]        BIT              NOT NULL,
    [PaymentStatusId]     INT              NULL,
    [PaidAmount]          DECIMAL (10, 2)  NOT NULL,
    [PendingAmount]       DECIMAL (10, 2)  NOT NULL,
    [PaidOn]              DATETIME         NULL,
    [PaidOptionsId]       INT              NULL,
    [PaidDesciption]      NVARCHAR (MAX)   NULL,
    [IsActive]            BIT              NOT NULL,
    [UpdatedDate]         DATETIME         NULL,
    [UpdatedBy]           NVARCHAR (100)   NULL,
    CONSTRAINT [PK_Transaction_Bill_Id] PRIMARY KEY CLUSTERED ([TransactionBillId] ASC)
);


GO
PRINT N'Creating Table [TRX].[TransactionPayment]...';


GO
CREATE TABLE [TRX].[TransactionPayment] (
    [Id] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating Foreign Key [TRX].[FK_Tenant_Room_Details_Id]...';


GO
ALTER TABLE [TRX].[TransactionAmount] WITH NOCHECK
    ADD CONSTRAINT [FK_Tenant_Room_Details_Id] FOREIGN KEY ([TenantRoomDetailsId]) REFERENCES [ROM].[TenantRoomDetails] ([TenantRoomDetailsId]);


GO
PRINT N'Creating Foreign Key [TRX].[FK_Transaction_Amount_Id]...';


GO
ALTER TABLE [TRX].[TransactionBills] WITH NOCHECK
    ADD CONSTRAINT [FK_Transaction_Amount_Id] FOREIGN KEY ([TransactionAmountId]) REFERENCES [TRX].[TransactionAmount] ([TransactionAmountId]);


GO
PRINT N'Creating Foreign Key [TRX].[FK_Payment_Status_Id]...';


GO
ALTER TABLE [TRX].[TransactionBills] WITH NOCHECK
    ADD CONSTRAINT [FK_Payment_Status_Id] FOREIGN KEY ([PaymentStatusId]) REFERENCES [COM].[PaymentStatus] ([Id]);


GO
PRINT N'Creating Foreign Key [TRX].[FK_Paid_Options]...';


GO
ALTER TABLE [TRX].[TransactionBills] WITH NOCHECK
    ADD CONSTRAINT [FK_Paid_Options] FOREIGN KEY ([PaidOptionsId]) REFERENCES [COM].[PaymentOptions] ([Id]);


GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [TRX].[TransactionAmount] WITH CHECK CHECK CONSTRAINT [FK_Tenant_Room_Details_Id];

ALTER TABLE [TRX].[TransactionBills] WITH CHECK CHECK CONSTRAINT [FK_Transaction_Amount_Id];

ALTER TABLE [TRX].[TransactionBills] WITH CHECK CHECK CONSTRAINT [FK_Payment_Status_Id];

ALTER TABLE [TRX].[TransactionBills] WITH CHECK CHECK CONSTRAINT [FK_Paid_Options];


GO
PRINT N'Update complete.';


GO
